{% extends "layout.html" %}

{% block content %}
<style>
    .ihc-table { width: 100%; border-collapse: collapse; text-align: center; }
    .ihc-table th, .ihc-table td { border: 1px solid #ddd; padding: 15px; }
    .full { background-color: #f8d7da; color: #721c24; }
    .available { background-color: #d4edda; color: #155724; }
</style>

<h2>ğŸ§ª IHC æŸ“è‰²æ©Ÿé ç´„ (æ‰˜ç›¤é™åˆ¶)</h2>
<p>æ—¥æœŸï¼š<strong>{{ today }}</strong> | ä½¿ç”¨è€…ï¼š<strong>{{ current_user or 'è«‹å…ˆé¸å–å§“å' }}</strong></p>

<table class="ihc-table">
    <thead>
        <tr style="background:#f2f2f2;">
            <th>æ™‚æ®µæ¢¯æ¬¡</th>
            <th>ç›®å‰å·²ä½”ç”¨æ‰˜ç›¤</th>
            <th>é ç´„æ“ä½œ</th>
        </tr>
    </thead>
    <tbody>
        {% for s in slots %}
        {% set current_trays = usage[s] %}
        <tr class="{{ 'full' if current_trays >= 3 else 'available' }}">
            <td><strong>{{ s }}</strong></td>
            <td>{{ current_trays }} / 3</td>
            <td>
                {% if current_trays < 3 and current_user %}
                <form method="POST">
                    <input type="hidden" name="slot" value="{{ s }}">
                    éœ€ä½¿ç”¨ï¼š
                    <select name="trays">
                        {% for i in range(1, (4 - current_trays)|int) %}
                        <option value="{{ i }}">{{ i }} æ‰˜ç›¤</option>
                        {% endfor %}
                    </select>
                    <button type="submit">ç¢ºèªé ç´„</button>
                </form>
                {% elif not current_user %}
                    <small>è«‹å…ˆåœ¨ä¸Šæ–¹é¸å–ä½¿ç”¨è€…</small>
                {% else %}
                    <strong>æ™‚æ®µå·²é¡æ»¿</strong>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}